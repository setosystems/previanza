{% extends "base.html" %}

{% block content %}
<div class="report-container">
    <div class="report-header">
        <div class="header-title">
            <i class="fas fa-user-circle"></i>
            <h1>Comisiones de {{ agent.name }}</h1>
        </div>
        
        <div class="filter-section">
            <form method="GET" class="filter-form">
                <div class="filter-group">
                    <div class="form-group">
                        <label for="start_date">Fecha Inicio:</label>
                        <input type="date" id="start_date" name="start_date" 
                               class="modern-input" value="{{ start_date or '' }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="end_date">Fecha Fin:</label>
                        <input type="date" id="end_date" name="end_date" 
                               class="modern-input" value="{{ end_date or '' }}">
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-filter"></i> Aplicar Filtros
                    </button>
                    <a href="{{ url_for('reports.commission_report') }}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Volver
                    </a>
                </div>
            </form>
        </div>
    </div>

    <div class="commission-summary">
        <div class="summary-card">
            <div class="card-icon pending">
                <i class="fas fa-clock"></i>
            </div>
            <div class="card-content">
                <h3>Comisiones Pendientes</h3>
                <p class="amount">${{ "{:,.2f}".format(total_pending) }}</p>
            </div>
        </div>
        
        <div class="summary-card">
            <div class="card-icon paid">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="card-content">
                <h3>Comisiones Pagadas</h3>
                <p class="amount">${{ "{:,.2f}".format(total_paid) }}</p>
            </div>
        </div>
        
        <div class="summary-card">
            <div class="card-icon total">
                <i class="fas fa-calculator"></i>
            </div>
            <div class="card-content">
                <h3>Total Comisiones</h3>
                <p class="amount">${{ "{:,.2f}".format(total_commission) }}</p>
            </div>
        </div>
    </div>

    <div class="commission-details">
        <div class="section-header">
            <h2>Detalle de Comisiones</h2>
        </div>
        
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Póliza</th>
                        <th>Producto</th>
                        <th class="text-right">Prima</th>
                        <th class="text-right">Comisión</th>
                        <th>Tipo</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for commission in commissions %}
                    <tr>
                        <td>{{ commission.Commission.date.strftime('%Y-%m-%d') }}</td>
                        <td>{{ commission.Policy.policy_number }}</td>
                        <td>{{ commission.Product.name }}</td>
                        <td class="text-right">${{ "{:,.2f}".format(commission.Policy.premium|float) }}</td>
                        <td class="text-right">${{ "{:,.2f}".format(commission.Commission.amount|float) }}</td>
                        <td>
                            {% if commission.Commission.commission_type == 'override' %}
                            Sobrecomisión
                            {% else %}
                            Directa
                            {% endif %}
                        </td>
                        <td>
                            <span class="status-badge {{ commission.Commission.payment_status.lower() }}">
                                {{ commission.Commission.payment_status }}
                            </span>
                        </td>
                        <td>
                            <form action="{{ url_for('reports.update_commission_status', commission_id=commission.Commission.id) }}" 
                                  method="POST" style="display: inline;">
                                <select name="status" onchange="this.form.submit()" class="status-select">
                                    <option value="PENDIENTE" {% if commission.Commission.payment_status == 'PENDIENTE' %}selected{% endif %}>
                                        Pendiente
                                    </option>
                                    <option value="PAGADO" {% if commission.Commission.payment_status == 'PAGADO' %}selected{% endif %}>
                                        Pagado
                                    </option>
                                    <option value="ANULADO" {% if commission.Commission.payment_status == 'ANULADO' %}selected{% endif %}>
                                        Anulado
                                    </option>
                                </select>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %} 