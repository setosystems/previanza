{% extends "base.html" %}

{% block content %}
<div class="form-container">
    <div class="form-header">
        <h1>Carga Masiva de Clientes</h1>
    </div>

    {% if summary %}
        <div class="error-summary">
            <h3><i class="fas fa-exclamation-triangle"></i> Resumen de la Carga</h3>
            <div class="error-stats">
                <span class="stat-item updated">
                    <i class="fas fa-sync"></i> Actualizados: {{ summary.updated }}
                </span>
                <span class="stat-item created">
                    <i class="fas fa-plus"></i> Creados: {{ summary.created }}
                </span>
                <span class="stat-item errors">
                    <i class="fas fa-times"></i> Errores: {{ summary.errors }}
                </span>
            </div>
            {% if summary.error_details %}
                <div class="error-details">
                    <h4>Detalles de los errores:</h4>
                    <ul>
                        {% for error in summary.error_details %}
                            <li>
                                <strong>Fila {{ error.row }}:</strong> 
                                {{ error.message }}
                                {% if error.data %}
                                    <br>
                                    <small>Datos de la fila: {{ error.data }}</small>
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        </div>
    {% endif %}

    <div class="form-section">
        <form method="POST" enctype="multipart/form-data" class="modern-form">
            <div class="form-field">
                <label for="file">Selecciona archivo XLSX:</label>
                <input type="file" class="modern-input" id="file" name="file" accept=".xlsx" required>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-upload"></i> Subir Archivo
                </button>
            </div>
        </form>
    </div>

    <div class="form-section">
        <h3>Instrucciones</h3>
        <p><strong>Nota:</strong> El archivo XLSX debe tener las siguientes columnas en orden:</p>
        <ul class="instruction-list">
            <li>Nombre</li>
            <li>Correo electrónico</li>
            <li>Teléfono</li>
            <li>Dirección</li>
            <li>Ciudad</li>
            <li>Tipo de Documento</li>
            <li>Número de Documento</li>
            <li>Fecha de Nacimiento (YYYY-MM-DD)</li>
        </ul>
        
        <div class="important-note">
            <p><strong>Importante:</strong> Si un cliente con el mismo correo electrónico ya existe, sus datos serán actualizados.</p>
        </div>
        
        <div class="form-actions">
            <a href="{{ url_for('clients.download_client_sample') }}" class="btn btn-secondary">
                <i class="fas fa-download"></i> Descargar archivo de ejemplo
            </a>
            <a href="{{ url_for('clients.list_clients') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Volver a la Lista de Clientes
            </a>
        </div>
    </div>
</div>

<style>
/* Los mismos estilos que en policies/bulk_upload.html */
.error-summary {
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    padding: 20px;
    margin: 20px 0;
}

.error-summary h3 {
    color: #721c24;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.error-stats {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.stat-item {
    padding: 8px 15px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.stat-item.updated {
    background-color: #d4edda;
    color: #155724;
}

.stat-item.created {
    background-color: #cce5ff;
    color: #004085;
}

.stat-item.errors {
    background-color: #f8d7da;
    color: #721c24;
}

.error-details {
    background-color: #f8f9fa;
    border-radius: 4px;
    padding: 15px;
    margin-top: 15px;
}

.error-details h4 {
    color: #721c24;
    margin-bottom: 10px;
}

.error-details ul {
    list-style-type: none;
    padding: 0;
}

.error-details li {
    padding: 10px;
    border-bottom: 1px solid #eee;
    color: #721c24;
}

.error-details li:last-child {
    border-bottom: none;
}

.error-details li small {
    display: block;
    color: #6c757d;
    margin-top: 5px;
}

.instruction-list {
    list-style-type: none;
    padding: 0;
    margin: 20px 0;
}

.instruction-list li {
    padding: 8px 0;
    border-bottom: 1px solid var(--border-color);
    color: var(--text-color);
}

.instruction-list li:last-child {
    border-bottom: none;
}

.important-note {
    background-color: #fff3cd;
    border: 1px solid #ffeeba;
    border-radius: 4px;
    padding: 15px;
    margin: 20px 0;
}

.important-note p {
    margin: 0;
    color: #856404;
}

.form-section {
    margin-bottom: 30px;
}

.form-section h3 {
    color: var(--text-color);
    margin-bottom: 20px;
}

.form-actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

@media (max-width: 768px) {
    .form-actions {
        flex-direction: column;
    }
    
    .form-actions .btn {
        width: 100%;
    }
}
</style>
{% endblock %}
